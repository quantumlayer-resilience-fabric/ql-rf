{{- if .Values.secrets.createSecrets }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ql-rf.secretName" . }}
  labels:
    {{- include "ql-rf.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database URL
  {{- if .Values.postgresql.enabled }}
  database-url: "postgres://{{ .Values.postgresql.auth.username }}:{{ .Values.secrets.databasePassword }}@{{ include "ql-rf.fullname" . }}-postgresql:5432/{{ .Values.postgresql.auth.database }}?sslmode=disable"
  {{- else }}
  database-url: "postgres://{{ .Values.externalDatabase.username }}@{{ .Values.externalDatabase.host }}:{{ .Values.externalDatabase.port }}/{{ .Values.externalDatabase.database }}?sslmode=require"
  {{- end }}

  # Redis URL
  {{- if .Values.redis.enabled }}
  redis-url: "redis://:{{ .Values.secrets.redisPassword }}@{{ include "ql-rf.fullname" . }}-redis-master:6379"
  {{- else if .Values.externalRedis.host }}
  redis-url: "redis://{{ .Values.externalRedis.host }}:{{ .Values.externalRedis.port }}"
  {{- end }}

  # LLM API Key
  {{- if .Values.secrets.llmApiKey }}
  llm-api-key: {{ .Values.secrets.llmApiKey | quote }}
  {{- end }}

  # Clerk Authentication
  {{- if .Values.secrets.clerkSecretKey }}
  clerk-secret-key: {{ .Values.secrets.clerkSecretKey | quote }}
  {{- end }}
  {{- if .Values.secrets.clerkPublishableKey }}
  clerk-publishable-key: {{ .Values.secrets.clerkPublishableKey | quote }}
  {{- end }}

  # AWS Credentials (optional - prefer IAM roles)
  {{- if .Values.secrets.aws.accessKeyId }}
  aws-access-key-id: {{ .Values.secrets.aws.accessKeyId | quote }}
  aws-secret-access-key: {{ .Values.secrets.aws.secretAccessKey | quote }}
  {{- end }}

  # Azure Credentials (optional - prefer managed identity)
  {{- if .Values.secrets.azure.clientId }}
  azure-client-id: {{ .Values.secrets.azure.clientId | quote }}
  azure-client-secret: {{ .Values.secrets.azure.clientSecret | quote }}
  azure-tenant-id: {{ .Values.secrets.azure.tenantId | quote }}
  azure-subscription-id: {{ .Values.secrets.azure.subscriptionId | quote }}
  {{- end }}

  # GCP Credentials (optional - prefer workload identity)
  {{- if .Values.secrets.gcp.serviceAccountKey }}
  gcp-service-account-key: {{ .Values.secrets.gcp.serviceAccountKey | quote }}
  {{- end }}
{{- end }}
